# -*- coding: utf-8 -*-
"""sepsis-identification.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/0B61wzy1XhnTfZm12bTJnQ0phOUVYMjNmYjJ2cEktcHItb2dz
"""

import matplotlib.pyplot as plt
from os import listdir
import seaborn as sns
import time
from pylab import rcParams
from os import listdir
import csv
from xgboost import XGBClassifier
import numpy as np # linear algebra
import pandas as pd # data processing, CSV file I/O (e.g. pd.read_csv)
from sklearn.metrics import accuracy_score

# a_traincsv = listdir('/kaggle/input/training_setA/training')
# b_traincsv = listdir('/kaggle/input/training_setB/training_setB')

train = pd.read_csv('train_patient.csv')
train.head()

train_copy = train.groupby('Patient_id').mean().fillna(train.mean())
train_copy['SepsisLabel'][train_copy['SepsisLabel']!=0] = 1
x = train_copy.drop(['SepsisLabel'],axis = 1)
y = train_copy['SepsisLabel']

test = pd.read_csv('results/test_patient.csv')
test_copy = test.fillna(train.mean())
x_test = test_copy.drop(['SepsisLabel','Patient_id'],axis = 1)
y_test = test_copy['SepsisLabel']

val = pd.read_csv('results/val_patient.csv')
val = val.fillna(train.mean())
x_val = val.drop(['SepsisLabel','Patient_id'],axis = 1)
y_val = val['SepsisLabel']

y.value_counts()

xgb = XGBClassifier()
xgb.fit(x,y)

y_pred = xgb.predict(x)
print("Train Accuracy: ",accuracy_score(y_pred, y))
y_pred = xgb.predict(x_test)
print("Test Accuracy: ",accuracy_score(y_pred, y_test))
y_pred = xgb.predict(x_val)
print("Validation Accuracy: ",accuracy_score(y_pred, y_val))

from sklearn import metrics 
y_pred = xgb.predict(x_test)
print("Test Accuracy: ",accuracy_score(y_pred, y_test))
cm=metrics.confusion_matrix(y_test, y_pred)
print(cm)
import seaborn as sn
sn.heatmap(cm, annot=True)

corrmat = train.corr()['SepsisLabel']
  
#f, ax = plt.subplots(figsize =(9, 8)) 
corrmat#.style.background_gradient(cmap='coolwarm')

pd.concat([train[train['SepsisLabel'] == 0][:int(1172238*0.02)],train[train['SepsisLabel'] == 1]],axis = 0).corr()['SepsisLabel']

train[train['Patient_id'] == 8]

